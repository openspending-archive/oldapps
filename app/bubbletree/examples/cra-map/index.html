<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8"/>
	<title>UK Country Regional Analysis</title>
	<script type="text/javascript" src="../../../../lib/vendor/jquery-1.5.2.min.js"></script>
	<script type="text/javascript" src="../../../../lib/vendor/jquery.history.js"></script>
	<script type="text/javascript" src="../../../../lib/vendor/jquery.tooltip.min.js"></script>
	<script type="text/javascript" src="../../../../lib/vendor/raphael.js"></script>
	<script type="text/javascript" src="../../../../lib/vendor/vis4.js"></script>
	<script type="text/javascript" src="../../../../lib/vendor/Tween.js"></script>
	<script type="text/javascript" src="../../bubbletree.min.js"></script>
	<script type="text/javascript" src="os.map.js"></script>
	
	<link rel="stylesheet" type="text/css" href="../../css/style.page.css" />
	<link rel="stylesheet" type="text/css" href="../../css/style.bubbletree.css" />
	<link rel="stylesheet" type="text/css" href="../../css/style.tooltips.css" />
	
	<script type="text/javascript" src="../../styles/style.cofog.js"></script>
	
	<script type="text/javascript">
       
		$(function() {
			
			var yearChange = function(year) {
				window.alert('year changed to '+year);
			};
			
			var $tooltip = $('<div class="tooltip">Tooltip</div>');
			$('#bubble-chart').append($tooltip);
			
			var tooltip = function(event) {
				if (event.type == 'SHOW') {
					// show tooltip
					vis4.log(event);
					$tooltip.css({ 
						left: event.mousePos.x + 4, 
						top: event.mousePos.y + 4 
					});
					$tooltip.html(event.node.label+' <b>'+event.node.famount+'</b><br/>'+event.node.taxonomy+' - '+event.node.name);
					var bubble = event.target;
					
					$tooltip.show();
				} else {
					// hide tooltip
					$tooltip.hide();
				}
			};
			
			var updateMap = function(node) {
				
			}
			
			var config = {
				// todo: we should really document all the settings
				apiUrl: 'http://openspending.org/api',
				// todo: ...
				localApiCache: 'aggregate.json',
				// todo: we should really document all the settings		
				dataset: 'cra',
				// todo: we should really document all the settings
				drilldowns: ['cofog1', 'cofog2', 'cofog3'],
				// todo: we should really document all the settings
				cuts: ['year:2008'],
				// todo: we should really document all the settings
				rootNodeLabel: 'Grant total', 
				// jquery selector code to identify the container div 
				container: '#bubble-chart',
				// 
				initYear: 2009,
				// breakdown
				breakdown: 'region',
				// this callback is invoked as soon as the year changes by url
				// defines what class is used to render the bubbles
				// possible values are pie,donut,plain,multi,icon
				bubbleType: ['icon', 'icon', 'icon', 'icon'],
				
				nodeClickCallback: updateMap,
				
				rootPath: '../../'
			};
			
			
			
			//config.tooltipCallback = tooltip;
			
			config.tooltipContent = function(node) {
				return node.label+'<br/><span class="amount">'+node.famount+'</span>';
			};
			
			config.yearChangeHandler = yearChange;
			
			config.bubbleStyles = config.bubbleStyles ? config.bubbleStyles : {};
			config.bubbleStyles['cofog'] = OpenSpending.BubbleTree.Styles.Cofog;	

			var map = new OpenSpending.Map('uk-map.svg', $('#map'));
			
			$('#maptypeswitch').click(function(e) {
				if (!$(e.target).hasClass('active')) {
					$('#maptypeswitch a').removeClass('active');
					$(e.target).addClass('active');
					map.mode = $(e.target).attr('name');
					map.updateValues(map.currentNode);
				}
			});
			
			var onNodeClick = function(node) {
				map.updateValues(node);
				$('#mapdesc').html('Map of Regional Spending on <div style="font-size:130%">'+node.label+'</div>');
			};

			config.nodeClickCallback = onNodeClick;
			config.firstNodeCallback = onNodeClick;
			new OpenSpending.BubbleTree.Loader(config);
		});

       
                                        
	</script>
	<style type="text/css">
		#bubble-chart-wrapper {
			width: 57%;
		}
		#map {
			width: 40%;
			position: absolute;
			top:0;
			right: 0;
			height: 95%;
		}
		#header { top: 15px; }
		#mapdesc { width: 35%; bottom: 2%; left: 60%; position: absolute; text-align: center; font-family: Graublau; }
		#maptypeswitch {
			z-index: 10000;
			position: absolute; bottom: 2%; right: 20px; font-family: Graublau; font-size:14px;
		}
		#maptypeswitch a {
			cursor: pointer; color: #999; padding: 0 0.5ex;
		}
		#maptypeswitch a.active {
			background: #861541; color: #fff; text-decoration: none;
		}
	</style>
	
</head>
<body>
	<div id="header"><a class="title">OpenSpending</a>
	<div class="subtitle">UK Country Regional Analysis</div></div>
	<!--<div id="menu">
		Select year: <select id="year"></select>
	</div>-->
	<div id="bubble-chart-wrapper">
		<div id="bubble-chart"></div>
	</div>
	<div id="map">
	
	</div>
	<div id="mapdesc">
		
	</div>
	<div id="maptypeswitch"><a name="total" class="active">Total</a> &nbsp;<a name="percapita">By Population</a></div>
</body>
</html>
